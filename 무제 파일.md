



## Docker-Compose
docker-compse.ymlì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë¡œ ì´ë™
ì´ê±° ê°™ì€ ê²½ìš°ì—ëŠ” docker-compose.yml íŒŒì¼ì´ ì € ìœ„ì¹˜ì— ìˆê¸° ë•Œë¬¸ì— ì €ê¸°ë¡œ ì´ë™ 
ë‹¤ë¥¸ê³³ì— ìˆìœ¼ë©´ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ ì´ë™í•´ì•¼í•¨
![[Docker-Composeëª…ë ¹ì–´11.png]]
![[Docker-Composeëª…ë ¹ì–´6.png]]



docker-compose up ì‹¤í–‰(ì´ë¯¸ ë§Œë“¤ì–´ ë†“ì€ ymlíŒŒì¼ì´ ìˆì„ê²½ìš°)
![[Docker-Composeëª…ë ¹ì–´7.png]]

ë¡œê·¸ì™€ í•¨ê»˜ ì‹¤í–‰
ì´ë•Œ ë‚˜ì˜¤ê³  ì‹¶ì„ ê²½ìš° ctrl + c ì…ë ¥
![[Docker-Composeëª…ë ¹ì–´8.png]]

ë„ì»¤ ì§€ìš°ê³  ì‹¶ì„ ë•Œ
docker-compose down

![[Docker-Composeëª…ë ¹ì–´9.png]]

docker-compose up -d  ë„ì»¤ ì»´í¬ì¦ˆ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰

![[Docker-Composeëª…ë ¹ì–´10.png]]


ê²°ê³¼
ë„ì»¤ ì»´í¬ì¦ˆ ì•ˆì— 3ê°œì˜ ì»¨í…Œì´ë„ˆ ìƒì„±
![[Docker-Composeëª…ë ¹ì–´12.png]]

![[Docker-Composeëª…ë ¹ì–´13.png]]





# Apache

```
apache:
    image: httpd:latest
    container_name: myApache
    ports:
      - 80:80
    volumes:
      - ./apache/httpd.conf:/usr/local/apache2/conf/httpd.conf
    depends_on:
      - tomcat
```


`httpd.conf` íŒŒì¼ì€ Apache HTTP Server (ì•„íŒŒì¹˜ ì›¹ ì„œë²„)ì˜ ì£¼ìš” êµ¬ì„± íŒŒì¼ì…ë‹ˆë‹¤. ì´ íŒŒì¼ì€ ì›¹ ì„œë²„ì˜ ë™ì‘ ë°©ì‹, ê°€ìƒ í˜¸ìŠ¤íŠ¸ ì„¤ì •, ëª¨ë“ˆ í™œì„±í™”, ì•¡ì„¸ìŠ¤ ì œì–´ ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ êµ¬ì„±í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

`httpd.conf` íŒŒì¼ì€ ì•„íŒŒì¹˜ ì›¹ ì„œë²„ì˜ ì„¤ì •ì„ ì§€ì •í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ì„¤ì •ì„ ì˜ˆë¡œ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤:

1. ê°€ìƒ í˜¸ìŠ¤íŠ¸ ì„¤ì •: `httpd.conf` íŒŒì¼ì„ í†µí•´ ê°€ìƒ í˜¸ìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ìƒ í˜¸ìŠ¤íŠ¸ëŠ” ë™ì¼í•œ ì„œë²„ì—ì„œ ì—¬ëŸ¬ ê°œì˜ ì›¹ ì‚¬ì´íŠ¸ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ê° ê°€ìƒ í˜¸ìŠ¤íŠ¸ëŠ” ë³„ë„ì˜ ì„¤ì •ì„ ê°€ì§€ë©°, `httpd.conf` íŒŒì¼ì—ì„œ í•´ë‹¹ ê°€ìƒ í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ ì„¤ì •ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
2. ëª¨ë“ˆ í™œì„±í™”: ì•„íŒŒì¹˜ ì›¹ ì„œë²„ëŠ” ë‹¤ì–‘í•œ ëª¨ë“ˆì„ ì œê³µí•˜ì—¬ ì¶”ê°€ ê¸°ëŠ¥ì„ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `httpd.conf` íŒŒì¼ì—ì„œëŠ” í•„ìš”í•œ ëª¨ë“ˆì„ í™œì„±í™”í•˜ê³  ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, SSL ëª¨ë“ˆì„ í™œì„±í™”í•˜ì—¬ HTTPS ì—°ê²°ì„ ì§€ì›í•˜ê±°ë‚˜, PHP ëª¨ë“ˆì„ í™œì„±í™”í•˜ì—¬ PHP ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì„ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
3. ì•¡ì„¸ìŠ¤ ì œì–´: `httpd.conf` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì›¹ ì„œë²„ì˜ ì•¡ì„¸ìŠ¤ ì œì–´ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • IP ì£¼ì†Œë‚˜ ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ê±°ë‚˜ ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì¸ì¦ê³¼ ê¶Œí•œ ì„¤ì •ì„ í†µí•´ ì ‘ê·¼ ì œí•œì„ êµ¬ì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### httpd.conf


```



ServerRoot "/usr/local/apache2"
Listen 80

LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so


<Files ".ht*">
    Require all denied
</Files>


<Directory "/usr/local/apache2/cgi-bin">
    AllowOverride None
    Options None
    Require all granted
</Directory>


<IfModule proxy_html_module>
Include conf/extra/proxy-html.conf
</IfModule>

<IfModule ssl_module>
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
</IfModule>

LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so

<VirtualHost *:80>
    ServerName localhost
    ProxyPass / http://tomcat:8080/ retry=1 acquire=3000 timeout=600
    ProxyPassReverse / http://tomcat:8080/
</VirtualHost>
```



## SSL


```

genrsa -out private.key 2048 >> private.keyëŠ” ë‹¤ë¥¸ê±¸ë¡œ ì„¤ì • ê°€ëŠ¥ ex) pp.key

rsa -in private.key -pubout -out public.key >> public.keyë„ ì„¤ì • ê°€ëŠ¥ pb.key
req -new -key private.key -out private.csr -config C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/openssl.cnf >>private.csrë„ ë‹¤ë¥¸ê±¸ë¡œ ì„¤ì • ê°€ëŠ¥ pp.csr

genrsa -aes256 -out rootCA.key 2048
>>rootCA.keyë„ ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ê°€ëŠ¥

req -x509 -new -nodes -key rootCA.key -days 3650 -out rootCA.pem -configÂ C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/openssl.cnf
>>rootCA.penë„ ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ê°€ëŠ¥ 

x509 -req -in private.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out private.crt -days 3650
>>private.crtë„ ì„¤ì • ê°€ëŠ¥ ex) pp.crt
```


 #### Common Name   ì§€ì •
![[DockerSSL1.png]]


ì§€ì •í›„ ymlì—ì„œ apache volumes ì¶”ê°€

```
apache:
    image: httpd:latest
    container_name: myApache
    ports:
      - 80:80
      - 8443:8443
    volumes:
      - ./apache/httpd.conf:/usr/local/apache2/conf/httpd.conf
    #  - ./apache/workers.properties:/usr/local/apache2/conf/workers.properties
    #  - ./apache/htdocs:/usr/local/apache2/htdocs # waríŒŒì¼ì„ í†°ìº£ì— ë°°í¬í•œ ê²½ìš° í•„ìš” x
      - C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/private.crt:/usr/local/apache2/conf/server.crt
      - C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/private.key:/usr/local/apache2/conf/server.key
    depends_on:
      - tomcat
    command: ["httpd-foreground"]  # SSL ëª¨ë“ˆ í™œì„±í™”ë¥¼ ìœ„í•œ ì»¤ë§¨ë“œ ì¶”ê°€

```



ì‹¤ì œë¡œ ìì‹ ì´ ë§Œë“  í‚¤ì™€ crtë¥¼ ê°€ì ¸ì™€ì•¼í•¨


```
<VirtualHost *:8443>
    ServerName localhost
    # SSL ì„¤ì • ì¶”ê°€
    SSLEngine on
    SSLCertificateFile /usr/local/apache2/conf/server.crt
    SSLCertificateKeyFile /usr/local/apache2/conf/server.key
    DocumentRoot /usr/local/apache2/htdocs
    ProxyPass / http://tomcat:8080/ retry=1 acquire=3000 timeout=600
    ProxyPassReverse / http://tomcat:8080/ 
</VirtualHost>
```

CNê³¼ ë™ì¼í•˜ê²Œ ServerName ì„¤ì •
- `SSLEngine on`: SSL ì—”ì§„ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ HTTPS ì—°ê²°ì„ ì‚¬ìš©í•˜ë„ë¡ Apacheì— ì•Œë ¤ì¤ë‹ˆë‹¤.
- `SSLCertificateFile /usr/local/apache2/conf/server.crt`: SSL ì¸ì¦ì„œ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
- `SSLCertificateKeyFile /usr/local/apache2/conf/server.key`: SSL ì¸ì¦ì„œì˜ ê°œì¸ í‚¤ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.


### Spring Securityë€?

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì¸ì¦ (Authentication) ,ê¶Œí•œ(Authorize) ë¶€ì—¬ ë° ë³´í˜¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í”„ë ˆì„ì›Œí¬ë‹¤.

Java / Java EE í”„ë ˆì„ì›Œí¬

ê°œë°œì„ í•˜ë©´ì„œ ë³´ì•ˆ ë¶„ì•¼ëŠ” ì‹œê°„ì´ ë§ì´ ì†Œìš”ë˜ëŠ” í™œë™ë“¤ ì¤‘ í•˜ë‚˜ë‹¤. Spring Securityë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì§œì—¬ì§„ ë‚´ë¶€ ë¡œì§ì„ í†µí•´ ì¸ì¦, ê¶Œí•œ í™•ì¸ì— í•„ìš”í•œ ê¸°ëŠ¥ê³¼ ì˜µì…˜ë“¤ì„ ì œê³µí•œë‹¤.

Spring SecurityëŠ” Spring ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ(ì¸ì¦ê³¼ ê¶Œí•œ, ì¸ê°€ ë“±)ì„ ë‹´ë‹¹í•˜ëŠ” ìŠ¤í”„ë§ í•˜ìœ„ í”„ë ˆì„ì›Œí¬ì´ë‹¤. Spring SecurityëŠ” 'ì¸ì¦'ê³¼ 'ê¶Œí•œ'ì— ëŒ€í•œ ë¶€ë¶„ì„ Filter íë¦„ì— ë”°ë¼ ì²˜ë¦¬í•˜ê³  ìˆë‹¤. 
FilterëŠ” Dispatcher Servletìœ¼ë¡œ ê°€ê¸° ì „ì— ì ìš©ë˜ë¯€ë¡œ ê°€ì¥ ë¨¼ì € URL ìš”ì²­ì„ ë°›ì§€ë§Œ, InterceptorëŠ” Dispatcherì™€ Controllerì‚¬ì´ì— ìœ„ì¹˜í•œë‹¤ëŠ” ì ì—ì„œ ì ìš© ì‹œê¸°ì˜ ì°¨ì´ê°€ ìˆë‹¤. 
Spring SecurityëŠ” ë³´ì•ˆê³¼ ê´€ë ¨í•´ì„œ ì²´ê³„ì ìœ¼ë¡œ ë§ì€ ì˜µì…˜ì„ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¼ì¼ì´ ë³´ì•ˆê´€ë ¨ ë¡œì§ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.


#### ì¸ì¦(Authentication) , ì¸ê°€(Authorization)


![[Security4.png]]

_ì¸ì¦ê³¼ ì¸ê°€ë€ ë¬´ì—‡ì¼ê¹Œ? ë³´í†µ ì¸ì¦ ì ˆì°¨ë¥¼ ê±°ì¹œ í›„ ì¸ê°€ ì ˆì°¨ë¥¼ ì§„í–‰í•œë‹¤._

- ì¸ì¦: í•´ë‹¹ ì‚¬ìš©ìê°€ ë³¸ì¸ì´ ë§ëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ì ˆì°¨.
- ì¸ê°€: ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìš”ì²­ëœ ìì›ì— ì ‘ê·¼ê°€ëŠ¥í•œê°€ë¥¼ ê²°ì •í•˜ëŠ” ì ˆì°¨

**ì¸ì¦ ë°©ì‹**

1. credential ë°©ì‹: username, passwordë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹

2. ì´ì¤‘ ì¸ì¦(twofactor ì¸ì¦): ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°œì¸ ì •ë³´ë¥¼ ì¸ì¦ í›„, ë‹¤ë¥¸ ì¸ì¦ ì²´ê³„(ì˜ˆ: ë¬¼ë¦¬ì ì¸ ì¹´ë“œ)ë¥¼ ì´ìš©í•˜ì—¬ ë‘ê°€ì§€ì˜ ì¡°í•©ìœ¼ë¡œ ì¸ì¦í•˜ëŠ” ë°©ì‹ì´ë‹¤.

3. í•˜ë“œì›¨ì–´ ì¸ì¦: ìë™ì°¨ í‚¤ì™€ ê°™ì€ ë°©ì‹

ì´ì¤‘ Spring SecurityëŠ” credential ê¸°ë°˜ì˜ ì¸ì¦ì„ ì·¨í•©ë‹ˆë‹¤.

- principal: ì•„ì´ë”” (username)  ë³´í˜¸ë°›ëŠ” Resourceì— ì ‘ê·¼í•˜ëŠ” ëŒ€ìƒ
- credential: ë¹„ë°€ë²ˆí˜¸ (password)  Resourceì— ì ‘ê·¼í•˜ëŠ” ëŒ€ìƒì˜ ë¹„ë°€ë²ˆí˜¸

íŠ¹ì • ìì›ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•˜ê¸° ìœ„í•´ì„œëŠ”Â **ê¶Œí•œ**ì„ ê°€ì§€ê²Œ ëœë‹¤.

íŠ¹ì • ê¶Œí•œì„ ì–»ê¸° ìœ„í•´ì„œëŠ” ìœ ì €ëŠ” ì¸ì¦ì •ë³´(Authentication)ê°€ í•„ìš”í•˜ê³  ê´€ë¦¬ìëŠ” í•´ë‹¹ ì •ë³´ë¥¼ ì°¸ê³ í•´ ê¶Œí•œì„ ì¸ê°€(Authorization)í•œë‹¤.

ë³´í¸ì ìœ¼ë¡œ username - password íŒ¨í„´ì˜ ì¸ì¦ë°©ì‹ì„ ê±°ì¹˜ê¸° ë•Œë¬¸ì—Â **ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” principal - credential íŒ¨í„´**ì„ ê°€ì§€ê²Œ ëœë‹¤.

#### Spring Securityì˜ íŠ¹ì§•

- Filterë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.
    - Spring MVCì™€ ë¶„ë¦¬ë˜ì–´ ê´€ë¦¬í•˜ê³  ë™ì‘í•  ìˆ˜ ìˆë‹¤.
- Beanìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
    - Spring Security 3.2ë¶€í„°ëŠ” XMLì„¤ì •ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

### ğŸ”Š ì„œë¸”ë¦¿ê³¼ í•„í„°

> ì¸ì¦ê³¼ ì¸ê°€ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì½”ë“œëŠ” ê¸°ì¡´ ì„œë¹„ìŠ¤ì™€ í•¨ê»˜ ì‘ì„±ë  ìˆ˜ ìˆë‹¤.  
> í•˜ì§€ë§Œ, ì¸ì¦ ë° ì¸ê°€ ì½”ë“œëŠ” í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ëŠ” ì „í˜€ ê´€ë ¨ì´ ì—†ìœ¼ë©°, ë³´ì•ˆì´ ìš”êµ¬ë˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—Â   
> Â  Â  ê°™ì€ ë³´ì•ˆ ì½”ë“œë¥¼ ë°˜ë³µí•  ê²½ìš°, ìˆ˜ì •í–ˆì„ ë•Œ ì•„ë¬´ëŸ° ìƒê´€ì—†ëŠ” ì˜ì—­ê¹Œì§€ ë³€ê²½ì´ ì „íŒŒë˜ëŠ” ìƒë‹¹í•œ í° ë‹¨ì ì´ ìˆë‹¤.

ê·¸ë ‡ê¸°ì— ì„œë¸”ë¦¿ 2.3 ë¶€í„°ëŠ” í•„í„°ë¼ëŠ” ê°œë…ì´ ì¶”ê°€ë˜ì—ˆë‹¤. ì„œë¸”ë¦¿ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, Requestì™€ Responseë¥¼ ë¨¼ì € ë°›ì•„  
Â  Â  ì¡°ì‘í•  ìˆ˜ ìˆë‹¤ëŠ” ì°¨ì´ì ì´ ì¡´ì¬í•œë‹¤.

ìŠ¤í”„ë§ MVC ëŠ” í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬, ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.

ì‰½ê²Œ í’€ì–´ì„œ ì„¤ëª…í•˜ìë©´, ë‹¨ í•˜ë‚˜ì˜ Dispatcher Servlet ì„ ì´ìš©í•˜ì—¬ ìš”ì²­ì„ ë°›ê³ , ì„œë¹„ìŠ¤ë¥¼ ì¶”ìƒí™”í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

ì¦‰, ìŠ¤í”„ë§ì—ì„œë„ í•„í„°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

```java
@ServletComponentScan
@WebServlet(name = "loadFilter", urlPattern = {"/*"}, loadOnStartup = 1}
public class LoadFilter {
    ...
}
```


```java
@Configuration
public class WebConfig {

    @Bean
    public FilterRegistrationBean logFilter() {
        FilterRegistrationBean<Filter> filterBean = new FilterRegistrationBean<>();
        filterBean.setFilter(new LogFilter());
        filterBean.setOrder(1);
        filterBean.addUrlPatterns("/*");
        return filterBean;
    }
}
```

í˜¹ì€ @ServletComponentScan ê³¼ Filter ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´ì— @WebFilter ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ëŠ” ë°©ë²• ì—­ì‹œ  ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

### âœ‚Â ìŠ¤í”„ë§ ì¸í„°ì…‰í„°

> ì„œë¸”ë¦¿ì€ ìë°” ì›¹ í‘œì¤€ì—ì„œ ì œê³µí•˜ë‚˜, ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVC ì—ì„œë§Œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.  
> ì„œë¸”ë¦¿ê³¼ ê´€ê³„ì—†ì´ Dispatcher Servlet ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ì— ê°€ê¸° ì „ì— ì‹¤í–‰ëœë‹¤.  
> ì¦‰, Spring MVC ì˜ í•µì‹¬ì¸ Dispatcher Servlet ì—ì„œ ë™ì‘í•˜ëŠ” ëª¨ë“  ê°ì²´ì™€ ì˜ˆì™¸ë“¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

- preHandle (boolean)
    - ì»¨íŠ¸ë¡¤ëŸ¬ì— ê°€ê¸°ì „ì— í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
    - ë°˜í™˜ê°’ì´ true ì´ë©´ ë‹¤ìŒ ì¸í„°ì…‰í„°ê°€ í˜¸ì¶œë˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë°”ë¡œ í˜¸ì¶œí•œë‹¤.
- postHandle (boolean)
    - ì»¨íŠ¸ë¡¤ëŸ¬ì˜ return ì´í›„ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
    - ë·°ì— ì „ë‹¬í•  Model ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤.
- afterCompletion
    - HTML ë·°ê°€ ë Œë”ë§ëœ ì´í›„ì— í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ

#### âš  ì£¼ì˜í•  ì 

> postHandle ë©”ì†Œë“œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì— ì˜ˆì™¸ê°€ ë°œìƒí•  ê²½ìš°, í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.  
> ë°˜ë©´ì— afterCompletion ë©”ì†Œë“œëŠ” ì˜ˆì™¸ì™€ ìƒê´€ì—†ì´Â **í•­ìƒ**Â í˜¸ì¶œëœë‹¤.

### âš” í•„í„° VS ì¸í„°ì…‰í„°

> í•„í„°ëŠ” J2EE í‘œì¤€ ìŠ¤í™ì— ì •ì˜ë˜ì–´ ìˆëŠ” ê¸°ìˆ ì´ê¸°ì—, Spring Framework ì— ì˜ì¡´ì ì´ì§€ ì•Šë‹¤.  
> ë°˜ë©´, ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì´ë‹¤.

![[Security8.png]]

ì›¹ ì• í”Œì¼€ì´ì…˜ì— ì „ì—­ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼í•˜ëŠ” ê¸°ëŠ¥ì€ í•„í„°ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ê³ , í´ë¼ì´ì–¸íŠ¸ì— ë“¤ì–´ì˜¤ëŠ” ë””í…Œì¼í•œ ì²˜ë¦¬ëŠ”  ì¸í„°ì…‰í„°ì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  í•œë‹¤.

## ğŸŒ« ìŠ¤í”„ë§ í•„í„°

> ìŠ¤í”„ë§ì—ì„œëŠ” ì„œë¸”ë¦¿ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ì—°ê²°í•  ìˆ˜ ìˆëŠ” DelegationFilterProxy ë¼ëŠ”  
> Â  Â  ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì œê³µí•œë‹¤.

DelegationFilterProxy ë¥¼ í†µí•´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ êµ¬í˜„í•œ í•„í„°ë¥¼ ë“±ë¡í•˜ê³ , ì„œë¸”ë¦¿ í‘œì¤€ í•„í„°ì²˜ëŸ¼ ë™ì‘í•˜ê²Œ ëœë‹¤.

ì¦‰, Spring Security ê°€ Filter ë¥¼ ì‚¬ìš©í•´ì„œ êµ¬í˜„í–ˆë‹¤ëŠ” ê²ƒì€ DelegationFilterProxy ë¥¼ í†µí•´ í•„í„°ë¥¼ ë“±ë¡í–ˆë‹¤ëŠ” ëœ»ì´ë‹¤.

Spring Security ëŠ” FilterChainProxy ë¥¼ í†µí•´ ë‹¤ì–‘í•œ í•„í„° ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë©°, ì´ëŠ” ìŠ¤í”„ë§ ë¹ˆì´ê¸°ì— DelegationFilterProxy ë¥¼

Â  Â  í†µí•´ í•„í„°ì— ì¶”ê°€ëœë‹¤.

### â˜„ FilterChainProxy

> Spring Security ì—ì„œ ì œê³µí•˜ëŠ” íŠ¹ìˆ˜ í•„í„°ë¡œ ë‹¤ì–‘í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ SecurityFilterChain ì„ í†µí•´ ìœ„ì„í•˜ê³  ìˆë‹¤.  
> ì¼ì¢…ì˜ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ìœ„í•œ ì „ìš© Dispatcher Servlet ì´ë¼ ìƒê°í•˜ë©´ ëœë‹¤.


### SecurityFilterChain

![[Security7.png]]

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•˜ë©´ ê°œë°œì‹œì— í•„ìš”í•œ ì‚¬ìš©ìì˜ ì¸ì¦, ê¶Œí•œ, ë³´ì•ˆ ì²˜ë¦¬ë¥¼ ê°„ë‹¨í•˜ì§€ë§Œ ê°•ë ¥í•˜ê²Œ êµ¬í˜„ í•  ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ì¸ ì›¹ í™˜ê²½ì—ì„œ ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì—ê²Œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ë©´, DispatcherServlet(FrontController)ê°€ ìš”ì²­ì„ ë°›ê¸° ì´ì „ì— ë§ì€ ServletFilter(ì„œë¸”ë¦¿ í•„í„°)ê±°ì¹˜ê²Œ ëœë‹¤. Securityì™€ ê´€ë ¨í•œ ì„œë¸”ë¦¿ í•„í„°ë„ ì‹¤ì œë¡œëŠ” ì—°ê²°ëœ ì—¬ëŸ¬ í•„í„°ë“¤ë¡œ êµ¬ì„± ë˜ì–´ ìˆë‹¤. ì´ëŸ¬í•œ ëª¨ìŠµë•Œë¬¸ì— Chain(ì²´ì¸)ì´ë¼ëŠ” í‘œí˜„ì„ ì“´ë‹¤.


- SecurityContextPersistenceFilter
    - SecurityContextRepository ì—ì„œ SecurityContext ë¥¼ ì¡°íšŒ ë° ì €ì¥
    - Authentication ê°ì²´ë¥¼ ë³´ê´€í•˜ëŠ” ì‹œíë¦¬í‹° ì»¨í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í•„í„°
- LogoutFilter
    - ì„¤ì •ëœ ë¡œê·¸ì•„ì›ƒ URL ë¡œ ì˜¤ëŠ” ìš”ì²­ì„ ê°ì‹œ ë° í•´ë‹¹ ìœ ì € ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
- UsernamePasswordAuthenticationFilter
    - Form ê¸°ë°˜ ì¸ì¦ì—ì„œ ì„¤ì •ëœ ë¡œê·¸ì¸ URL ë¡œ ì˜¤ëŠ” ìš”ì²­ì„ ê°ì‹œ ë° ìœ ì € ì¸ì¦ ì²˜ë¦¬
    - AuthenticationManager ë¥¼ í†µí•œ ì¸ì¦
    - ì¸ì¦ ì„±ê³µì‹œ, ì–»ì€ Authentication ê°ì²´ë¥¼ SecurityContext ì— ì €ì¥, AuthenticationSuccessHandler ì‹¤í–‰
    - ì¸ì¦ ì‹¤íŒ¨ì‹œ, AuthenticationFailureHandler ì‹¤í–‰
- DefaultLoginPageGeneratingFilter
    - ì¸ì¦ì„ ìœ„í•œ ë¡œê·¸ì¸ í¼ URL ê°ì‹œ
- BasicAuthenticationFilter
    - HTTP ê¸°ë³¸ ì¸ì¦ í—¤ë”ë¥¼ ê°ì‹œ ë° ì²˜ë¦¬
- RequestCacheAwareFilter
    - ë¡œê·¸ì¸ ì„±ê³µ í›„, ì›ë˜ ìš”ì²­ ì •ë³´ë¥¼ ì œêµ¬ì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.
- SecurityContextHolderAwareRequestFilter
    - HttpServletRequestWrapper ë¥¼ ìƒì†í•œ SecurityContextHolderAwareRequestWrapper í´ë˜ìŠ¤ë¡œ  
        Â  Â  HttpServletRequest ì •ë³´ë¥¼ ê°ì‹¼ë‹¤.
    - SecurityContextHolderAwareRequestWrapper ëŠ” í•„í„° ì²´ì¸ì—ê²Œ ë‹¤ìŒ í•„í„°ë“¤ì—ê²Œ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.
- AnonymousAuthenticationFilter
    - ì‚¬ìš©ì ì •ë³´ê°€ ì¸ì¦ë˜ì§€ ì•Šì•˜ë‹¤ë©´, ì¸ì¦ í† í°ì— ì‚¬ìš©ìê°€ ìµëª… ì‚¬ìš©ìë¡œ ë‚˜íƒ€ë‚œë‹¤.
- SessionManagementFilter
    - ì¸ì¦ëœ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“  ì„¸ì…˜ì„ ì¶”ì í•œë‹¤.
- ExceptionTranslationFilter
    - ë³´í˜¸ëœ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë„ì¤‘, ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ìœ„ì„ ë° ì „ë‹¬í•œë‹¤.
- FilterSecurityInterceptor
    - AccessDecisionManager ë¡œì¨ ê¶Œí•œ ë¶€ì—¬ ì²˜ë¦¬ë¥¼ ìœ„ì„í•˜ì—¬ ì ‘ê·¼ ì œì–´ë¥¼ ì‰½ê²Œ í•´ì¤€ë‹¤.
- CorsFilter
	- í—ˆê°€ëœ ì‚¬ì´íŠ¸ë‚˜ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì¸ì§€ ê²€ì‚¬í•˜ëŠ” í•„í„°
- CsrfFilter
	- CSRF ê³µê²©ì„ ë°©ì–´í•˜ëŠ” í•„í„°
- BearerTokenAuthenticationFilter 
	- JWT ì¸ì¦ í•„í„°
- RememberMeAuthenticationFilter 
	- RememberMe ì¿ í‚¤ë¥¼ ê²€ì‚¬í•˜ì—¬ ì¸ì¦í•˜ëŠ” í•„í„°
- HeaderWriterFilter 
	- ì‘ë‹µ(Response)ì— ì‹œíë¦¬í‹°ì™€ ê´€ë ¨ëœ í—¤ë”ë¥¼ ì„¤ì •í•˜ëŠ” í•„í„°
- WebAsyncManagerIntegrationFilter 
	- ë¹„ë™ê¸° ê¸°ëŠ¥ì„ ì‚¬ìš©í• ë•Œ ì‹œíë¦¬í‹° ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” í•„í„°
### Spring Security Architecture(êµ¬ì¡°)

![[Security1.png]]

ì´ ì‚¬ì§„ì€ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ì•„í‚¤í…ì²˜ ì‚¬ì§„ì´ê³  ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ íë¦„ì€ ì•„ë˜ì™€ ê°™ë‹¤.

**1. Http Request ìˆ˜ì‹ **Â 

-> ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì •ë³´ì™€ í•¨ê»˜ ì¸ì¦ ìš”ì²­ì„ í•œë‹¤.

**2. ìœ ì € ìê²©ì„ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦í† í° ìƒì„±**Â 

-> AuthenticationFilterê°€ ìš”ì²­ì„ ê°€ë¡œì±„ê³ , ê°€ë¡œì±ˆ ì •ë³´ë¥¼ í†µí•´ UsernamePasswordAuthenticationTokenì˜ ì¸ì¦ìš© ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

**3. FIlterë¥¼ í†µí•´ AuthenticationTokenì„ AuthenticationManagerë¡œ ìœ„ì„**

-> AuthenticationManagerì˜ êµ¬í˜„ì²´ì¸ ProviderManagerì—ê²Œ ìƒì„±í•œ UsernamePasswordToken ê°ì²´ë¥¼ ì „ë‹¬í•œë‹¤.

**4. AuthenticationProviderì˜ ëª©ë¡ìœ¼ë¡œ ì¸ì¦ì„ ì‹œë„**

-> AutenticationMangerëŠ” ë“±ë¡ëœ AuthenticationProviderë“¤ì„ ì¡°íšŒí•˜ë©° ì¸ì¦ì„ ìš”êµ¬í•œë‹¤.

**5. UserDetailsServiceì˜ ìš”êµ¬**

-> ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì¸ì¦ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” UserDetailsServiceì— ì‚¬ìš©ì ì •ë³´ë¥¼ ë„˜ê²¨ì¤€ë‹¤.

**6. UserDetailsë¥¼ ì´ìš©í•´ Userê°ì²´ì— ëŒ€í•œ ì •ë³´ íƒìƒ‰**

-> ë„˜ê²¨ë°›ì€ ì‚¬ìš©ì ì •ë³´ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì°¾ì•„ë‚¸ ì‚¬ìš©ì ì •ë³´ì¸ UserDetails ê°ì²´ë¥¼ ë§Œë“ ë‹¤.

**7. User ê°ì²´ì˜ ì •ë³´ë“¤ì„ UserDetailsê°€ UserDetailsService(LoginService)ë¡œ ì „ë‹¬**

-> AuthenticaitonProviderë“¤ì€ UserDetailsë¥¼ ë„˜ê²¨ë°›ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ë¹„êµí•œë‹¤.

**8. ì¸ì¦ ê°ì²´ or AuthenticationException**

-> ì¸ì¦ì´ ì™„ë£Œê°€ë˜ë©´ ê¶Œí•œ ë“±ì˜ ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ì€ Authentication ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

**9. ì¸ì¦ ë**

-> ë‹¤ì‹œ ìµœì´ˆì˜ AuthenticationFilterì— Authentication ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.

**10. SecurityContextì— ì¸ì¦ ê°ì²´ë¥¼ ì„¤ì •**

-> Authentication ê°ì²´ë¥¼ Security Contextì— ì €ì¥í•œë‹¤.

ìµœì¢…ì ìœ¼ë¡œëŠ” SecurityContextHolderëŠ” ì„¸ì…˜ ì˜ì—­ì— ìˆëŠ” SecurityContextì— Authentication ê°ì²´ë¥¼ ì €ì¥í•œë‹¤. ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•œë‹¤ëŠ” ê²ƒì€ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì „í†µì ì¸ ì„¸ì„ -ì¿ í‚¤ ê¸°ë°˜ì˜ ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.



