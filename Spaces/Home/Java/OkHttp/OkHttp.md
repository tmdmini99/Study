## Â Android í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬

### âœ” OkHttp

- OkHttpëŠ” Squareì— ì˜í•´ ê°œë°œëœ ì˜¤í”ˆ ì†ŒìŠ¤ HTTP í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
- REST API ë° ì„œë²„ì™€ HTTP ê¸°ë°˜ì˜ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ê³¼ ì‘ë‹µì— í¸ì˜ì„± ì œê³µì„ ìœ„í•œ ëª©ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.
- ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” *Connection poolingê³¼ Redirectionì„ ë„ì…í•´ ì ‘ì†ì„ ë” ì•ˆì •ì ì´ê²Œ í•˜ë©´ì„œë„, ì†ë„ë¥¼ ê°œì„ ì‹œí‚¬ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ê°€ì§€ ê¸°ìˆ ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

#### íŠ¹ì§•

- *Okioì™€ ì½”í‹€ë¦°ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.
- *Connection poolingê³¼ Redirectionì„ ë„ì…í•´ ë” ì•ˆì •ì ì´ê³  ê°œì„ ëœ ì†ë„ë¡œ HTTP í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
- OkHttpëŠ” í†µì‹ ì„ ë™ê¸°í™”ë¡œí• ì§€ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œí• ì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤, í•˜ì§€ë§Œ ìŠ¤ë ˆë“œë¥¼ ë„˜ë‚˜ë“¤ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ Handlerë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### ì˜ˆì œ

```kotlin
// Get URL
OkHttpClient client = new OkHttpClient();

String run(String url) throws IOException {
  Request request = new Request.Builder()
      .url(url)
      .build();

  try (Response response = client.newCall(request).execute()) {
    return response.body().string();
  }
}

// Post to a Server
public static final MediaType JSON = MediaType.get("application/json; charset=utf-8");

OkHttpClient client = new OkHttpClient();

String post(String url, String json) throws IOException {
  RequestBody body = RequestBody.create(json, JSON);
  Request request = new Request.Builder()
      .url(url)
      .post(body)
      .build();
  try (Response response = client.newCall(request).execute()) {
    return response.body().string();
  }
}
```

### âœ” Retrofit

- Retrofitì€ OkHttpë¥¼ ê°œë°œí•œ Squareì—ì„œ 2013/05/14 ì— ë°œí‘œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. HttpURLConnectionì„ ì‚¬ìš©í•˜ê¸° í¸í•˜ë„ë¡ ë©í•‘í•œê²Œ Volleyë¼ë©´Â **Retrofitì€ OkHttpë¥¼ ë©í•‘í•œ ê²ƒ**ì…ë‹ˆë‹¤.
- ë‚´ë¶€ì ìœ¼ë¡œëŠ” OkHttpë¥¼ ì‚¬ìš©í•˜ì—¬ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. RESTful APIë¥¼ ì‰½ê²Œ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ ìë°” ê°ì²´ì— ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### íŠ¹ì§•

- íƒ€ì… ì„¸ì´í”„(Type safe): Javaë‚˜ Kotlinì˜ ì¸í„°í˜ì´ìŠ¤ì™€ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ APIë¥¼ ì •ì˜í•˜ë¯€ë¡œ, ì»´íŒŒì¼ ì‹œê°„ì— ì˜¤ë¥˜ë¥¼ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë¹„ë™ê¸° ë° ë™ê¸° ìš”ì²­ ì§€ì›:Â **Call ë˜ëŠ” RxJava, Kotlin Coroutines**ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬Â **ë¹„ë™ê¸° ì²˜ë¦¬**ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ìë™ JSON íŒŒì‹±:Â **GSON, Jackson, Moshi ë“± ë‹¤ì–‘í•œ JSON ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì—°ë™**ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ì½”ë“œ ìµœì í™”: Retrofitì€Â **ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì½”ë“œë¥¼ ìƒì„±**í•˜ê¸° ë•Œë¬¸ì— API í˜¸ì¶œ ì½”ë“œê°€ ë§¤ìš° ê°„ê²°í•˜ê³  ê°€ë…ì„±ì´ ë†’ì•„, ìœ ì§€ë³´ìˆ˜ê°€ ì‰½ìŠµë‹ˆë‹¤.

#### ì˜ˆì œ

```kotlin

interface ApiService {
    @GET("users/2")
    fun getUser(): Call<User>
}

data class User(
    val id: Int,
    val name: String,
    val email: String
)

// Activity
class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val retrofit = Retrofit.Builder()
            .baseUrl("https://jsonplaceholder.typicode.com/")
            .addConverterFactory(GsonConverterFactory.create())
            .build()

        val apiService = retrofit.create(ApiService::class.java)

        apiService.getUser().enqueue(object : Callback<User> {
            override fun onResponse(call: Call<User>, response: Response<User>) {
                if (response.isSuccessful) {
                    val user = response.body()
                    // TODO: user ê°ì²´ë¥¼ ì´ìš©í•œ ì‘ì—…
                }
            }

            override fun onFailure(call: Call<User>, t: Throwable) {
                // TODO: ì—ëŸ¬ ì²˜ë¦¬
            }
        })
    }
}
```

## âœ… OkHttp ì™€ Retrofitì˜ ë¹„êµ

### ê³µí†µì ì¸ íŠ¹ì§•

- Squareì—ì„œ ë§Œë“ Â **HTTP í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬**ì…ë‹ˆë‹¤.
- OkHttpë¥¼ ë˜í•‘í•˜ì—¬ ë” Type-safeí•˜ê³ , ë” ì§ê´€ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì¸í„°í˜ì´ìŠ¤ë¡œ ë§Œë“¤ì–´ì§„ ê²Œ Retrofitì…ë‹ˆë‹¤. ë”°ë¼ì„œÂ **ê·¼ë³¸ì ì¸ HTTP í†µì‹  êµ¬ì¡°ëŠ” ë™ì¼**í•©ë‹ˆë‹¤.

### ì°¨ì´ì 

- **ì¶”ìƒí™” ë ˆë²¨**:
    - OkHttp:Â **ë‚®ì€ ìˆ˜ì¤€ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬**ë¡œ, HTTP ìš”ì²­ê³¼ ì‘ë‹µì„ ìƒì„±í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë¹„êµì  ë³µì¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - Retrofit:Â **ë†’ì€ ìˆ˜ì¤€ì˜ ì¶”ìƒí™”**ë¥¼ ì œê³µí•˜ë©°,Â **ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **Response Handling**:
    - OkHttp:Â **ì‘ë‹µì„ ì§ì ‘ ì²˜ë¦¬**í•´ì•¼ í•˜ë©°, JSON íŒŒì‹± ë“±ì˜ ì‘ì—…ë„ ìˆ˜ë™ìœ¼ë¡œ í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - enqueueë¥¼ ì‚¬ìš©í•˜ë©´ ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì´Â **ìë™ìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œ**ì—ì„œ ìˆ˜í–‰ë˜ì§€ë§Œ,Â **Thread ë³€ê²½ ê¸°ëŠ¥ì´ ì œê³µë˜ì§€ ì•Šê¸°**ì— ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸ í•˜ê¸° ìœ„í•´Â **runOnUiThread**ë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.
    - Retrofit:
        - **GSON, Jackson ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬**ì™€ ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆì–´ ìë™ìœ¼ë¡œ JSONì„Â **Java/Kotlin ê°ì²´ë¡œ ë³€í™˜**í•´ì¤ë‹ˆë‹¤.
        - Retrofitì˜ ê²½ìš°Â **enqueueë¥¼ ì‚¬ìš©í•˜ë©´ ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì´ ë°±ê·¸ë¼ìš´ë“œ**ì—ì„œ ì´ë£¨ì–´ì§€ë©°,Â **ìë™ìœ¼ë¡œ ë©”ì¸ìŠ¤ë ˆë“œì— ì „ë‹¬**ë©ë‹ˆë‹¤.
- **ìš©ë„**:
    - OkHttp: ë‹¨ìˆœí•œ API í˜¸ì¶œë¶€í„° ì›¹ ì†Œì¼“, HTTP/2 ë“±ê³¼ ê°™ì€ ë³µì¡í•œ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ê¹Œì§€ ìˆ˜í–‰í•˜ëŠ”ë°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
    - Retrofit: ì£¼ë¡œ REST ë˜ëŠ” GraphQLê³¼ ê°™ì€ APIì— ìš”ì²­ì„ ë³´ë‚´ëŠ” ì‘ì—…ì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

> ğŸ”«Â **ì •ë¦¬í•˜ìë©´**  
> Retrofitì´ OkHttpë³´ë‹¤ ì¢‹ì€ì ì€,
> 
> - ì–´ë…¸í…Œì´ì…˜(Annotation) ì‚¬ìš©ìœ¼ë¡œ ì½”ë“œì˜ ê°€ë…ì„±ì´ ì¢‹ê³ , ì§ê´€ì ì¸ ì„¤ê³„ê°€ëŠ¥.
> - í†µì‹  ê²°ê³¼ê°’ì„ JSONìœ¼ë¡œ ë³€í™˜í•´ì¤„ í•„ìš”ê°€ ì—†ìŒ
> - ê²°ê³¼ê°’ì„ ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

> ğŸŒŸÂ _**BUT**_Â **ë‘˜ì„ ê°™ì´ ì“°ëŠ” ì´ìœ **ëŠ”,  
> **OkHttpì˜ Interceptor ê¸°ëŠ¥**: OkHttp ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” HTTP í˜¸ì¶œì„ ì¤‘ê°„ì—ì„œ ê°€ë¡œì±Œ ìˆ˜ ìˆëŠ” Interceptor ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ API í˜¸ì¶œ ì „í›„ì— íŠ¹ì • ë¡œì§ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì˜ˆë¥¼ ë“¤ì–´ ë¡œê¹…, í—¤ë” ì¶”ê°€, ìºì‹± ì •ì±… ì„¤ì • ë“±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
> **ì„œë²„ í†µì‹  ì‹œê°„ ì¡°ì ˆ**: OkHttpë¥¼ ì‚¬ìš©í•˜ë©´ ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì˜ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì„œë²„ì™€ì˜ í†µì‹ ì„ ë”ìš± ì•ˆì •ì ìœ¼ë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.  
> **Retrofitì€ ì´ëŸ¬í•œ OkHttpì˜ ê¸°ëŠ¥ì„ ë”ìš± ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°**, ìë™ìœ¼ë¡œ JSON ë˜ëŠ” ë‹¤ë¥¸ ë°ì´í„° í˜•ì‹ì„ ìë°” ê°ì²´ë¡œ ë³€í™˜í•´ì£¼ëŠ” ê¸°ëŠ¥, API í˜¸ì¶œì˜ ê°„í¸í™” ë“± ë‹¤ì–‘í•œ ì¶”ê°€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

> ğŸ“Â **ê²°ê³¼ì ìœ¼ë¡œ**, OkHttpì˜ ì„¸ë°€í•œ ë„¤íŠ¸ì›Œí¬ ì œì–´ ê¸°ëŠ¥ê³¼ Retrofitì˜ ì‚¬ìš©ì ì¹œí™”ì ì¸ API í˜¸ì¶œ ê¸°ëŠ¥ì„ ê²°í•©í•˜ì—¬Â **ìµœê³ ì˜ ì„±ëŠ¥ê³¼ í¸ì˜ì„±ì„ ë™ì‹œì— ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**Â ì´ëŸ¬í•œ ì´ìœ ë¡œ ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì´Â **ë³´í¸ì ì…**ë‹ˆë‹¤.

## âœ… ì–´ë ¤ìš´ ë‹¨ì–´ ì •ë¦¬

- **Connection pooling**: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì…ë‹ˆë‹¤. HTTP ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•´ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì— ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ë§ºì–´ì•¼ í•˜ëŠ”ë°, ì´ëŸ¬í•œ ì—°ê²°ì„ ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±í•˜ê³  í•´ì œí•˜ëŠ” ê³¼ì •ì€ ìƒë‹¹íˆ ë¹„ìš©ì´ í½ë‹ˆë‹¤. ì—°ê²°ì„ ë§ºê³  ëŠëŠ” ë° ë“œëŠ” ì‹œê°„ê³¼ ìì›ì„ ì ˆì•½í•˜ê¸° ìœ„í•´, ì´ë¯¸ ì‚¬ìš©ëœ ì—°ê²°ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ 'Connection Pool'ì´ë¼ê³  í•©ë‹ˆë‹¤.
    
- **Okio**: OkioëŠ” Squareì‚¬ì—ì„œ ê°œë°œí•œ ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ê¸°ë³¸ ìë°” I/O ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê³  ë” íš¨ìœ¨ì ì¸ I/O ì‘ì—…ì„ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. OkioëŠ” íŠ¹íˆ ë°”ì´íŠ¸ ì½”ë“œì˜ íš¨ìœ¨ì ì¸ ì½ê¸° ë° ì“°ê¸°ë¥¼ ìœ„í•´ ë§Œë“¤ì–´ì¡Œìœ¼ë©°, ê·¸ ì™¸ì—ë„ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.





---
ì¶œì²˜ - https://velog.io/@kej_ad/Android-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%ED%86%B5%EC%8B%A0-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%ACOkHttp-Retrofit