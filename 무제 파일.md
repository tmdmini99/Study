



## Docker-Compose
docker-compse.yml이 있는 디렉토리로 이동
이거 같은 경우에는 docker-compose.yml 파일이 저 위치에 있기 때문에 저기로 이동 
다른곳에 있으면 다른 곳으로 이동해야함
![[Docker-Compose명령어11.png]]
![[Docker-Compose명령어6.png]]



docker-compose up 실행(이미 만들어 놓은 yml파일이 있을경우)
![[Docker-Compose명령어7.png]]

로그와 함께 실행
이때 나오고 싶을 경우 ctrl + c 입력
![[Docker-Compose명령어8.png]]

도커 지우고 싶을 때
docker-compose down

![[Docker-Compose명령어9.png]]

docker-compose up -d  도커 컴포즈 백그라운드 실행

![[Docker-Compose명령어10.png]]


결과
도커 컴포즈 안에 3개의 컨테이너 생성
![[Docker-Compose명령어12.png]]

![[Docker-Compose명령어13.png]]





# Apache

```
apache:
    image: httpd:latest
    container_name: myApache
    ports:
      - 80:80
    volumes:
      - ./apache/httpd.conf:/usr/local/apache2/conf/httpd.conf
    #  - ./apache/workers.properties:/usr/local/apache2/conf/workers.properties
      - ./apache/htdocs:/usr/local/apache2/htdocs # war파일을 톰캣에 배포한 경우 필요 x
    depends_on:
      - tomcat
```


`httpd.conf` 파일은 Apache HTTP Server (아파치 웹 서버)의 주요 구성 파일입니다. 이 파일은 웹 서버의 동작 방식, 가상 호스트 설정, 모듈 활성화, 액세스 제어 등 다양한 기능을 구성하는 데 사용됩니다.

`httpd.conf` 파일은 아파치 웹 서버의 설정을 지정하는 역할을 합니다. 몇 가지 중요한 설정을 예로 들어보겠습니다:

1. 가상 호스트 설정: `httpd.conf` 파일을 통해 가상 호스트를 구성할 수 있습니다. 가상 호스트는 동일한 서버에서 여러 개의 웹 사이트를 호스팅하는 방법을 제공합니다. 각 가상 호스트는 별도의 설정을 가지며, `httpd.conf` 파일에서 해당 가상 호스트에 대한 설정을 지정할 수 있습니다.
    
2. 모듈 활성화: 아파치 웹 서버는 다양한 모듈을 제공하여 추가 기능을 확장할 수 있습니다. `httpd.conf` 파일에서는 필요한 모듈을 활성화하고 설정할 수 있습니다. 예를 들어, SSL 모듈을 활성화하여 HTTPS 연결을 지원하거나, PHP 모듈을 활성화하여 PHP 스크립트 실행을 지원할 수 있습니다.
    
3. 액세스 제어: `httpd.conf` 파일을 사용하여 웹 서버의 액세스 제어를 구성할 수 있습니다. 예를 들어, 특정 IP 주소나 디렉토리에 대한 액세스를 허용하거나 거부할 수 있습니다. 또한, 인증과 권한 설정을 통해 접근 제한을 구성할 수도 있습니다.

### httpd.conf


```



ServerRoot "/usr/local/apache2"
Listen 80

LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule env_module modules/mod_env.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule version_module modules/mod_version.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so


<Files ".ht*">
    Require all denied
</Files>


<Directory "/usr/local/apache2/cgi-bin">
    AllowOverride None
    Options None
    Require all granted
</Directory>


<IfModule proxy_html_module>
Include conf/extra/proxy-html.conf
</IfModule>

<IfModule ssl_module>
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
</IfModule>

LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so

<VirtualHost *:80>
    ServerName localhost
    ProxyPass / http://tomcat:8080/ retry=1 acquire=3000 timeout=600
    ProxyPassReverse / http://tomcat:8080/
</VirtualHost>
```



## SSL


```

genrsa -out private.key 2048 >> private.key는 다른걸로 설정 가능 ex) pp.key

rsa -in private.key -pubout -out public.key >> public.key도 설정 가능 pb.key
req -new -key private.key -out private.csr -config C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/openssl.cnf >>private.csr도 다른걸로 설정 가능 pp.csr

genrsa -aes256 -out rootCA.key 2048
>>rootCA.key도 원하는 이름으로 가능

req -x509 -new -nodes -key rootCA.key -days 3650 -out rootCA.pem -config C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/openssl.cnf
>>rootCA.pen도 원하는 이름으로 가능 

x509 -req -in private.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out private.crt -days 3650
>>private.crt도 설정 가능 ex) pp.crt
```


 #### Common Name   지정
![[DockerSSL1.png]]


지정후 yml에서 apache volumes 추가

```
apache:
    image: httpd:latest
    container_name: myApache
    ports:
      - 80:80
      - 8443:8443
    volumes:
      - ./apache/httpd.conf:/usr/local/apache2/conf/httpd.conf
    #  - ./apache/workers.properties:/usr/local/apache2/conf/workers.properties
    #  - ./apache/htdocs:/usr/local/apache2/htdocs # war파일을 톰캣에 배포한 경우 필요 x
      - C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/private.crt:/usr/local/apache2/conf/server.crt
      - C:\Users\tmdal\Downloads\openssl-1.0.2j-fips-x86_64\OpenSSL\bin/private.key:/usr/local/apache2/conf/server.key
    depends_on:
      - tomcat
    command: ["httpd-foreground"]  # SSL 모듈 활성화를 위한 커맨드 추가

```



실제로 자신이 만든 키와 crt를 가져와야함


```
<VirtualHost *:8443>
    ServerName localhost
    # SSL 설정 추가
    SSLEngine on
    SSLCertificateFile /usr/local/apache2/conf/server.crt
    SSLCertificateKeyFile /usr/local/apache2/conf/server.key
    DocumentRoot /usr/local/apache2/htdocs
    ProxyPass / http://tomcat:8080/ retry=1 acquire=3000 timeout=600
    ProxyPassReverse / http://tomcat:8080/ 
</VirtualHost>
```

CN과 동일하게 ServerName 설정
- `SSLEngine on`: SSL 엔진을 활성화합니다. 이 설정은 HTTPS 연결을 사용하도록 Apache에 알려줍니다.
- `SSLCertificateFile /usr/local/apache2/conf/server.crt`: SSL 인증서 파일의 경로를 지정합니다.
- `SSLCertificateKeyFile /usr/local/apache2/conf/server.key`: SSL 인증서의 개인 키 파일의 경로를 지정합니다.