# TCP/IP소켓과 웹소켓의 차이

(TCP/IP) 소켓에 대한 내용은 [여기](https://velog.io/@rhdmstj17/%EC%86%8C%EC%BC%93%EA%B3%BC-%EC%9B%B9%EC%86%8C%EC%BC%93-%ED%95%9C-%EB%B2%88%EC%97%90-%EC%A0%95%EB%A6%AC-1)서 볼 수 있다. 이제 소켓은 대충 알겠고 .. 웹소켓은 뭘까?

일단 소켓과 웹소켓은 **IP와 포트를 통한 통신**을 한다는 점에서는 **비슷하다.** 또, 둘 다 양방향 통신을 한다는 비슷한 특징을 갖고 있기도 하다.

차이점은,  
**웹 소켓은 HTTP 레이어에서 작동하는 소켓으로 TCP/IP 소켓의 레이어가 다르다!**  
그러니 두 개념은 엄연히 다르다. 같다고 혼동하지 않아야한다.

# WebSocket

웹소켓은 http에서 실시간 통신을 할 수 없다는 문제를 해결하기 위해 나온 기술이다! 웹소켓의 탄생 배경이 되는, http의 특징에 대해 간략히 살펴보자.

## HTTP로는 실시간 통신을 할 수 없어요

웹소켓의 탄생배경을 알기 위해선 http의 특징에 대해 짚고 넘어가야한다.

- 비연결성 (단방향)
- 매번 연결 **맺고 끊는** 과정의 비용
- **request-response** 의 구조
- 헤더의 비중이 너무 큼 → 실시간성으로 많은 데이터를 주고 받고자 하는 경우에는 매우 부담이 되는 요소 중 하나
[[http]]는 위와 같은 특징을 같고 있기 때문이다. 즉, 요청을 보내면 응답이 오는 **단방향적 구조로 통신**하기 때문에 TCP/IP 프로토콜을 사용하는 소켓처럼 계속 connection이 유지되는 **실시간 통신을 할 수 없다.** 이의 문제점을 해결하기 위해 나온것이 웹소켓 프로토콜이다.

## 웹소켓은 실시간 통신을 할 수 있어요

- 연결지향 (양방향)
- 한 번 **연결 맺은 뒤 유지**
- 핸드쉐이크 과정에서는 헤더의 비중이 크지만, 한번 연결이 되면 간단한 메시지들만 오고감 → 굉장히 경제적임

웹소켓은 위와 같은 특징으로 실시간 통신을 할 수 있다. 웹소켓은 http를 대체할 수 있는 개념까진 아니고, 그저 **웹에서 실시간 통신을 해야하는 상황에서 잘 쓰이는 프로토콜 중 하나**라고 생각하면 된다. 위에서 언급했지만 이름부터 웹소켓이기에 http 레이어 위에서 작동한다.

## 웹소켓 정확히 언제 쓰지?

당연한 얘기지만 실시간 통신을 해야하는 상황에 쓴다. 아래와 같이!

**case1** | B유저와 게임을 할때 타유저가 게임 action을 줄 때마다 새로고침을 해야함 → 매우 불편하겠죠? 즉, 게임할 때  
**case 2** | 채팅을 해야할 때  
**case 3** | 실시간 주식 거래 사이트를 만들 때 .. 등등

## 웹 소켓 동작 방법

### 1. 일단 손을 맞잡는다 🤝 핸드쉐이킹!

채널에 대한 정상적인 통신이 시작되기 전에 두 개의 실체 간에 확립된 통신 채널의 변수를 동적으로 설정하는 자동화된 협상과정


![[WebSocket1.png]]

### 2. 이제 데이터를 넣을 프레임을 구성하자! Frame 구성

최초 접속에서만 http 프로토콜 위에서 핸드쉐이킹을 하기 때문에 http 헤더를 사용한다.  
웹소켓을 위한 별도의 포트는 없으며 기존 포트(http-80,https-443)를 사용(호환된다는 의미)  
프레임으로 구성된 메시지라는 논리적 단위로 송수신  
메시지에 포함될 수 있는 교환 가능한 메시지(frame)는 텍스트와 바이너리 뿐!



![[WebSocket2.png]]

웹 소켓 동작 과정은 크게 세가지로 나눌 수 있다.

위 이미지의 빨간 색 박스에 해당하는 **Opening Handshake**  
위 이미지의 노란 색 박스에 해당하는 **Data transfer**  
위 이미지의 보라 색 박스에 해당하는 **Closing Handshake**



## 웹 소켓 프로토콜 특징

- 최초 접속시에만 http프로토콜 위에서 handshaking을 하기 때문에 http header를 사용한다
- 웹소켓을 위한 별도의 포트는 없고, 기존 포트를 사용한다
- 프레임으로 구성된 메시지라는 논리적 단위로 송수신 한다
- 메시지에 포함될 수 있는 교환 가능한 메시지는 텍스트와 바이너리 뿐이다




## 웹소켓 한계

웹소켓은 html5이후에 나왔다. html5이전 기술로 구현된 서비스에서는 어떻게 해야할까?

### 1. Socket.io, SockJS

Socker.io, SockerJS가 html5이전의 기술로 구현된 서비스에서 웹 소켓처럼 사용할 수 있도록 도와주는 기술임. 이걸로 실시간 통신을 도와준다.

결국 브라우저와 웹서버의 종류와 버전을 파악하여 가장 적합한 기술을 선택해 웹소켓처럼 보여지게 기능을 만든다!

### 2. STOMP

```null
웹소켓은 문자열들을 주고받을 수 있게 해줄 뿐 그 이상의 일은 하지 않는다. 주고 받는 문자열의 해독은 온전히 어플리케이션에 맡긴다

HTTP는 형식을 정해두었기 때문에 모두가 약속을 따르기만 하면 해석할 수 있다. 하지만 WebSocker방식은 sub-protocols을 사용해서 주고 받는 메시지의 형태를 약속하는 경우가 많음

sub-protocol로 자주 쓰이는게 STOMP

- STOMP
```




---
참조 -  https://velog.io/@rhdmstj17/%EC%86%8C%EC%BC%93%EA%B3%BC-%EC%9B%B9%EC%86%8C%EC%BC%93-%ED%95%9C-%EB%B2%88%EC%97%90-%EC%A0%95%EB%A6%AC-2  - 실시간 통신

 웹소켓- https://gusrb3164.github.io/web/2021/10/28/websocket-socket/
https://urmaru.com/7
https://velog.io/@stbpiza/%EC%9B%B9%EC%86%8C%EC%BC%93-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C


https://velog.io/@bnb8419/Socket.io%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EC%B1%84%ED%8C%85%EA%B5%AC%ED%98%84 


https://velog.io/@codingbotpark/Web-Socket-%EC%9D%B4%EB%9E%80
